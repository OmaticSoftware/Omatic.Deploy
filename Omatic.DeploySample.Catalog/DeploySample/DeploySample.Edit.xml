<EditDataFormTemplateSpec 
	xmlns="bb_appfx_editdataformtemplate"
	xmlns:c="bb_appfx_commontypes" 
	ID="5d6a2f8c-8655-41b8-9b99-6606b83a4bf7" 
	Name="Omatic Deploy Sample Edit Data Form"
	Description="Sample edit data form spec" 
	Author="Omatic"
	DataFormInstanceID="4b2f9de6-2c11-4fcb-8abf-60970b6d6a23" 
	RecordType="Omatic Deploy Sample"
	c:SecurityUIFolder="Deploy Sample"
	FormHeader="Edit a sample"
	>

	<SPDataForm>

		<LoadImplementation SPName="USR_USP_DATAFORMTEMPLATE_EDITLOAD_DEPLOYSAMPLE">
			<c:CreateProcedureSQL>
				<![CDATA[
create procedure dbo.USR_USP_DATAFORMTEMPLATE_EDITLOAD_DEPLOYSAMPLE
(
    @ID uniqueidentifier,
    @DATALOADED bit = 0 output,
    @TSLONG bigint = 0 output,
	  @NAME nvarchar(100) = null output,
	  @DESCRIPTION nvarchar(4000) = null output
)
as

	set nocount on;

	set @DATALOADED = 0
	set @TSLONG = 0

	select
		@DATALOADED = 1,
		@TSLONG = TSLONG,
		@NAME = NAME,
		@DESCRIPTION = DESCRIPTION
	from dbo.USR_DEPLOYSAMPLE
	where ID = @ID

	return 0;
				]]>
			</c:CreateProcedureSQL>
		</LoadImplementation>

		<SaveImplementation SPName="USR_USP_DATAFORMTEMPLATE_EDIT_DEPLOYSAMPLE">
			<c:CreateProcedureSQL>
				<![CDATA[
create procedure dbo.USR_USP_DATAFORMTEMPLATE_EDIT_DEPLOYSAMPLE 
(
	@ID uniqueidentifier,
	@CHANGEAGENTID uniqueidentifier = null,
	@NAME nvarchar(100),
	@DESCRIPTION nvarchar(4000)
)
as

	set nocount on;

	if @CHANGEAGENTID is null  
		exec dbo.USP_CHANGEAGENT_GETORCREATECHANGEAGENT @CHANGEAGENTID output
				
	declare @CURRENTDATE datetime
	set @CURRENTDATE = getdate()

	begin try
		-- handle updating the data
		update dbo.USR_DEPLOYSAMPLE set
			NAME = @NAME,
			DESCRIPTION = @DESCRIPTION,
			CHANGEDBYID = @CHANGEAGENTID,
			DATECHANGED = @CURRENTDATE
		where ID = @ID
	end try
	begin catch
		exec dbo.USP_RAISE_ERROR
		return 1
	end catch

return 0;
				]]>
			</c:CreateProcedureSQL>
		</SaveImplementation>

	</SPDataForm>

	<FormMetaData xmlns="bb_appfx_commontypes">
		<FormFields>
			<FormField FieldID="NAME" Caption="Name" DataType="String" MaxLength="100" />
			<FormField FieldID="DESCRIPTION" Caption="Description" DataType="String" MaxLength="4000" Multiline="true" />
		</FormFields>
	</FormMetaData>

</EditDataFormTemplateSpec>